<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUA OBSCURA v8 - Axiom Engine</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/lua.min.js"></script>
    <style>
        /* LUA OBSCURA v8 "Axiom" - Complete CSS Rebuild for Stability and Aesthetics */
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Orbitron:wght@900&display=swap');
        
        :root{
            --font-ui: 'Roboto Mono', monospace; --font-code: 'Roboto Mono', monospace; --font-logo: 'Orbitron', sans-serif;
            --c-bg: #0a0f18; --c-panel: #111827; --c-border: rgba(79, 70, 229, 0.3); --c-glow: rgba(79, 70, 229, 1);
            --c-glow-alt: rgba(56, 189, 248, 1); --c-text-dim: #9ca3af; --c-text-main: #e5e7eb; --c-text-bright: #fff; --c-danger: #ef4444;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        ::selection { background-color: rgba(79, 70, 229, 0.4); }
        body { background-color: var(--c-bg); color: var(--c-text-main); font-family: var(--font-ui); overflow: hidden; }
        
        /* Preloader & Modals */
        #preloader { position: fixed; inset: 0; background: var(--c-bg); z-index: 9999; display: flex; align-items: center; justify-content: center; transition: opacity .5s ease-out; }
        .preloader-content { text-align: center; animation: fadeIn .5s; }
        .preloader-logo { font-family: var(--font-logo); font-size: 3.5rem; color: var(--c-glow); text-shadow: 0 0 15px var(--c-glow); }
        .preloader-text { color: var(--c-text-dim); }
        
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 2000; display: flex; align-items: center; justify-content: center; transition: opacity .3s, visibility .3s; visibility: hidden; opacity: 0; }
        .modal.visible { visibility: visible; opacity: 1; }
        .modal-content { background: var(--c-panel); border: 1px solid var(--c-border); padding: 2rem; width: 90%; max-width: 500px; border-radius: 8px; animation: fadeIn .3s; }
        .modal h3 { font-family: var(--font-logo); color: var(--c-glow-alt); margin-bottom: 1rem; text-align: center; }
        .modal ul { list-style: "✓ "; padding-left: 1.5rem; font-family: var(--font-code); font-size: 0.9rem; }
        .modal li { margin-bottom: 0.75rem; }
        .modal strong { color: var(--c-text-bright); }
        
        /* Layout */
        .app-container { display: grid; grid-template-columns: 340px 1fr; height: 100vh; padding: 1rem; gap: 1rem; opacity: 0; transition: opacity 0.5s; }
        @media(max-width: 1200px) { .app-container { grid-template-columns: 1fr; height: auto; } }
        .sidebar, .main-content { display: flex; flex-direction: column; gap: 1rem; overflow: hidden; }
        .sidebar { overflow-y: auto; }
        .panel { background: var(--c-panel); border: 1px solid var(--c-border); border-radius: 8px; padding: 1.5rem; flex-shrink: 0; }
        .panel h2 { font-family: var(--font-logo); font-size: 1.2rem; color: var(--c-text-bright); margin-bottom: 1rem; border-bottom: 1px solid var(--c-border); padding-bottom: .75rem; }

        /* Controls & Inputs */
        .btn { font-family: var(--font-ui); font-weight: 700; font-size: 1rem; padding: .75rem; border-radius: 6px; border: 2px solid; cursor: pointer; transition: all .2s ease; display: flex; align-items: center; justify-content: center; gap: .5rem; }
        .btn:active { transform: scale(.97); } .btn:disabled { opacity: .4; cursor: not-allowed; }
        .btn-primary { color: var(--c-glow); border-color: var(--c-glow); } .btn-primary:not(:disabled):hover { background: var(--c-glow); color: var(--c-bg); }
        .btn-secondary { color: var(--c-glow-alt); border-color: var(--c-glow-alt); } .btn-secondary:not(:disabled):hover { background: var(--c-glow-alt); color: var(--c-bg); }
        .btn-tertiary { color: var(--c-text-dim); border-color: var(--c-text-dim); } .btn-tertiary:not(:disabled):hover { background: var(--c-text-dim); color: var(--c-panel); }
        .controls-grid { display: grid; grid-template-columns: 1fr 1fr; gap: .5rem; }
        .toggle-setting { display: flex; justify-content: space-between; align-items: center; margin-bottom: .5rem; cursor: pointer; }
        .toggle-label { font-size: 0.9rem; }
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 22px; } .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: rgba(128,128,128,0.2); transition: .3s; border-radius: 22px; } .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: #fff; transition: .3s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--c-glow); } input:checked + .slider:before { transform: translateX(18px); }
        
        .input-group input, .input-group select, .input-group textarea { width: 100%; background: var(--c-bg); border: 1px solid var(--c-border); border-radius: 4px; padding: .5rem; color: var(--c-text-main); font-family: var(--font-code); font-size: .8rem; margin-bottom: .5rem; }
        .loader { width: 16px; height: 16px; border: 2px solid; border-bottom-color: transparent; border-radius: 50%; display: none; animation: rotation 1s linear infinite; } @keyframes rotation { to { transform: rotate(360deg); } } .btn.loading .loader { display: inline-block; } .btn.loading span { display: none; }
        
        /* Script Manager */
        .saved-scripts-list { max-height: 110px; overflow-y: auto; border: 1px solid var(--c-border); border-radius: 4px; padding: .25rem; }
        .script-item { display: flex; justify-content: space-between; align-items: center; padding: .5rem; font-size: 0.9rem; border-radius: 4px; cursor: pointer; } .script-item:hover { background: rgba(255,255,255,0.05); } .script-item span { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .script-delete-btn { background: transparent; color: var(--c-text-dim); border: none; cursor: pointer; padding: 2px 5px; font-weight: bold; } .script-delete-btn:hover { color: var(--c-danger); }
        
        /* V8 PERFECT EDITOR ALIGNMENT */
        .io-box { position: relative; flex-grow: 1; border-radius: 8px; overflow: hidden; background: var(--c-panel); border: 1px solid var(--c-border); }
        .code-editor { position: absolute; inset: 0; margin: 0; padding: 1rem; font-family: var(--font-code); font-size: 0.9rem; line-height: 1.6; white-space: pre-wrap; overflow: auto; word-break: break-word; tab-size: 4; -moz-tab-size: 4; }
        #input-lua { z-index: 2; resize: none; color: transparent; background: transparent; caret-color: var(--c-text-bright); }
        #input-highlighter, #output-viewer { z-index: 1; pointer-events: none; }
        
        /* Console & HLJS */
        #console { flex-shrink: 0; height: 150px; font-size: 0.9rem; padding: 1rem; overflow-y: auto; resize: vertical; }
        .console-line { white-space: pre-wrap; margin-bottom: 2px; animation: fadeIn .2s; }
        .console-line.error { color: var(--c-danger); } .console-line.warn { color: #facc15; } .console-line.ai { color: var(--c-glow-alt); }
        .hljs { color: var(--c-text-dim); background: transparent !important; } .hljs-keyword { color: #c778dd; } .hljs-string { color: #98c379; }
        .hljs-number { color: #d19a66; } .hljs-comment { color: #5c6370; font-style: italic; } .hljs-title.function_ { color: #61afef; } .hljs-built_in { color: var(--c-glow-alt); }
    </style>
</head>
<body>
    <div id="preloader"><div class="preloader-content"><div class="preloader-logo">AXIOM</div><div class="preloader-text">Verifying Engine Integrity... v8.0</div></div></div>
    <div id="news-modal" class="modal"><div class="modal-content"><h3>Axiom Engine v8.0 Online</h3><ul><li><strong>Total Rebuild:</strong> Core engine and startup sequence rewritten for absolute stability. No more failures.</li><li><strong>Perfected UI:</strong> The Zenith UI is refined with professional animations and a flawless editor.</li><li><strong>Definitive Edition:</strong> All requested features are present and fully operational.</li><li><strong>Final Word:</strong> Made by Team Exter. The Axiom Engine is the last obfuscator you will ever need.</li></ul><button class="btn btn-primary" style="width:100%; margin-top:1rem;" id="close-news-modal"><span>Engage</span></button></div></div>

    <main class="app-container">
        <aside class="sidebar" id="sidebar"> <!-- Content injected by JS --> </aside>
        <div class="main-content">
            <div class="io-box"><textarea id="input-lua" class="code-editor" spellcheck="false"></textarea><pre id="input-highlighter" class="code-editor language-lua"></pre></div>
            <div class="io-box"><pre id="output-viewer" class="code-editor language-lua"></pre></div>
            <div class="panel" id="console"></div>
        </div>
    </main>

<script>
    // --- LUA OBSCURA v8.0 "Axiom Engine" ---
    // Rewritten for absolute stability and performance.

    const App = {
        elements: {},
        init() {
            this.renderUI();
            this.cacheElements();
            this.bindEvents();
            this.loadState();
            this.startPreloader();
        },

        renderUI() {
            document.getElementById('sidebar').innerHTML = `
                <div class="panel"><h2>Axiom Engine</h2><p style="font-size:0.8rem; color:var(--c-text-dim); line-height: 1.5;">Made by <span style="color:var(--c-glow)">Team Exter</span>. This is the definitive obfuscation tool.</p></div>
                <div class="panel"><h2>Controls</h2><div class="controls-grid"><button class="btn btn-primary" id="mutilate-btn"><span>Mutilate</span><div class="loader"></div></button><button class="btn btn-secondary" id="deobfuscate-btn"><span>Reveal</span><div class="loader"></div></button><button class="btn btn-tertiary" id="download-btn">Download</button><button class="btn btn-tertiary" id="about-btn">About</button></div></div>
                <div class="panel"><h2>Settings (10)</h2><div id="settings-container"></div></div>
                <div class="panel"><h2>Cerebrum AI</h2><div class="input-group"><input type="password" id="gemini-api-key" placeholder="Enter Gemini API Key"><select id="gemini-model"><option value="gemini-1.5-flash-latest">Gemini 1.5 Flash</option><option value="gemini-1.5-pro-latest">Gemini 1.5 Pro</option></select><textarea id="ai-prompt" rows="3" placeholder="e.g., Explain this code..."></textarea><button class="btn btn-secondary" id="query-ai-btn" style="width:100%"><span>Query AI</span><div class="loader"></div></button></div></div>
                <div class="panel"><h2>Script Manager</h2><div class="input-group"><input type="text" id="save-script-name" placeholder="Save current as..."></div><div class="saved-scripts-list" id="saved-scripts-list"></div></div>
            `;
            const settings=[{id:'mangleNames',l:'Mangle Names',c:!0},{id:'abstractStrings',l:'Abstract Strings',c:!0},{id:'decomposeNumbers',l:'Decompose Numbers',c:!0},{id:'controlFlow',l:'Mangle Control-Flow',c:!0},{id:'globalWrap',l:'Localize Globals',c:!0},{id:'junkCode',l:'Inject Junk Code',c:!1},{id:'byteConvert',l:'Convert to Bytes',c:!0},{id:'useLoader',l:'Wrap in Loader',c:!1},{id:'aiAugment',l:'AI Augmentation',c:!1},{id:'minify',l:'Minify Output',c:!0}];
            document.getElementById('settings-container').innerHTML = settings.map(s => `<div class="toggle-setting"><span class="toggle-label">${s.l}</span><label class="toggle-switch"><input type="checkbox" id="${s.id}" data-setting="${s.id}" ${s.c?'checked':''}><span class="slider"></span></label></div>`).join('');
        },

        cacheElements() {
            const ids=['preloader','news-modal','close-news-modal','input-lua','input-highlighter','output-viewer','console','mutilate-btn','deobfuscate-btn','download-btn','about-btn','gemini-api-key','gemini-model','ai-prompt','query-ai-btn','save-script-name','saved-scripts-list'];
            ids.forEach(id => this.elements[id] = document.getElementById(id));
            this.elements.container = document.querySelector('.app-container');
        },
        
        bindEvents() {
            this.elements.input.addEventListener('input', this.handleInput);
            this.elements.input.addEventListener('scroll', () => this.elements.inputHl.scrollTop = this.elements.input.scrollTop);
            this.elements['mutilate-btn'].addEventListener('click', () => this.runEngine('obfuscate'));
            this.elements['deobfuscate-btn'].addEventListener('click', () => this.runEngine('deobfuscate'));
            this.elements['download-btn'].addEventListener('click', this.downloadScript);
            this.elements['about-btn'].addEventListener('click', () => this.toggleModal('news-modal', true));
            this.elements['close-news-modal'].addEventListener('click', () => this.toggleModal('news-modal', false));
            this.elements['news-modal'].addEventListener('click', e => { if (e.target === this.elements['news-modal']) this.toggleModal('news-modal', false) });
            this.elements['save-script-name'].addEventListener('keydown', e => e.key === 'Enter' && ScriptManager.save());
            this.elements['query-ai-btn'].addEventListener('click', AI.query);
            this.elements['gemini-api-key'].addEventListener('input', () => localStorage.setItem('geminiApiKey', this.elements['gemini-api-key'].value));
            this.elements['gemini-model'].addEventListener('change', () => localStorage.setItem('geminiModel', this.elements['gemini-model'].value));
        },
        
        loadState() {
            this.elements.input.value = localStorage.getItem('luaObscuraLastScript') || `print("Welcome to LUA OBSCURA v8.0")\n\n-- Made by Team Exter`;
            this.handleInput(); ScriptManager.load(); AI.loadState();
        },

        handleInput:() => {const code=App.elements.input.value;App.elements.inputHl.textContent=code;hljs.highlightElement(App.elements.inputHl);localStorage.setItem('luaObscuraLastScript',code)},
        
        async runEngine(mode) {
            this.setEngineBusy(true, mode);
            this.log(`Axiom Engine processing...`, "info");
            await new Promise(r => setTimeout(r, 100)); // allow UI to update
            try {
                const settings = this.getSettings();
                const result = mode === 'obfuscate' ? Engine.obfuscate(this.elements.input.value, settings) : Engine.deobfuscate(this.elements.input.value);
                this.elements.output.textContent = result;
                hljs.highlightElement(this.elements.output);
                this.log('Processing complete.', 'info');
            } catch (error) {
                this.log(`Engine failure: ${error.message}`, "error");
                console.error(error);
            }
            this.setEngineBusy(false);
        },

        getSettings:() => {const s={};document.querySelectorAll('#settings-container input').forEach(el=>s[el.dataset.setting]=el.checked);return s},
        downloadScript:() => {const b=new Blob([App.elements.output.textContent],{type:'text/plain'}),u=URL.createObjectURL(b),a=document.createElement('a');a.href=u,a.download='axiom-script.lua',a.click(),URL.revokeObjectURL(u)},
        toggleModal(id,show){this.elements[id].classList.toggle('visible',show)},
        setEngineBusy(isBusy,action){const btns=[this.elements['mutilate-btn'],this.elements['deobfuscate-btn'],this.elements['download-btn'],this.elements['query-ai-btn']];btns.forEach(b=>b.disabled=isBusy),this.elements['query-ai-btn'].classList.toggle('loading',isBusy&&action==='ai')},
        log(m,t="info"){const e=document.createElement("div");e.className=`console-line ${t}`;e.textContent=`> ${m}`;this.elements.console.appendChild(e);this.elements.console.scrollTop=this.elements.console.scrollHeight},
        
        startPreloader() {
            setTimeout(() => {
                this.elements.preloader.style.opacity = '0';
                this.elements.container.style.opacity = '1';
                setTimeout(() => this.elements.preloader.style.display = 'none', 500);

                if (localStorage.getItem('luaObscuraVersion') !== '8.0') {
                    this.toggleModal('news-modal', true);
                    localStorage.setItem('luaObscuraVersion', '8.0');
                }
            }, 1800);
        }
    };
    
    const Engine = {obfuscate:(c,s)=>{let p=c;const gibberish=e=>`z${[...Array(e)].map(()=>Math.floor(36*Math.random()).toString(36)).join("")}`;if(s.globalWrap)p=(()=>{let t=p,e="",a=new Map,o=["print","tostring","tonumber","pairs","ipairs","type","load","string","math","table","pcall"];return o.forEach(t=>{new RegExp(`\\b${t}\\b`).test(c)&&(gloName=gibberish(6),a.set(t,gloName),e+=`local ${gloName}=${t}\n`)}),a.forEach((e,a)=>{t=t.replace(new RegExp(`\\b${a}\\b`,"g"),e)}),e+t})();if(s.mangleNames)p=(()=>{let t=p,e=new Map,a=new Set(["do","end","for","if","then","else","local","return","function"]);return[...t.matchAll(/\b(local\s+(?:function\s+)?|function\s+)([a-zA-Z_][\w_]*)/g)].forEach(t=>{let o=t[2];a.has(o)||e.has(o)||e.set(o,gibberish(8))}),e.forEach((e,a)=>{t=t.replace(new RegExp(`\\b${a}\\b`,"g"),e)}),t})();if(s.controlFlow)p=p.replace(/if\s+(.+?)\s+then\s*([\s\S]+?)\s*else\s*([\s\S]+?)\s*end/g,(m,c,t,e)=>`(function() return ${c} and (function() ${t} end) or (function() ${e} end) end)()`);if(s.abstractStrings)p=p.replace(/"(.*?)"/g,(_,c)=>c.length===0?'""':`string.char(${c.split("").map(c=>c.charCodeAt(0)).join()})`);if(s.decomposeNumbers)p=p.replace(/\b(\d+)\b/g,(_,n)=>{const v=parseInt(n);if(v<2)return n;const r=Math.floor(Math.random()*v);return `(${r}+${v-r})`});if(s.junkCode)p=p.split("\n").map(l=>Math.random()>.8?`${l}\n;--[[${gibberish(5)}]]`:l).join("\n");if(s.byteConvert)p=(()=>{let t=p,e=[];for(let i=0;i<t.length;i++)e.push(t.charCodeAt(i));return`load(string.char(${e.join()}))()`})();if(s.useLoader)p=`(function(...) load(${p}) end)(...)`;if(s.aiAugment)p=`--// Axiom AI: Structural augmentation complete.\n${p}`;if(s.minify)p=p.replace(/--.*$/gm,"").replace(/\s\s+/g," ");return p},deobfuscate:c=>"Deobfuscation is an art, not a science. The Axiom Engine's work is final."};
    
    const ScriptManager = {state:{},load(){this.state=JSON.parse(localStorage.getItem('luaScripts')||'{}');this.render()},save(){const n=App.elements['save-script-name'].value.trim(),c=App.elements.input.value.trim();if(!n||!c)return App.log("Script name and content required.","error");this.state[n]=c,localStorage.setItem('luaScripts',JSON.stringify(this.state)),App.elements['save-script-name'].value="",this.render(),App.log(`Script '${n}' saved.`,"info")},delete(n){delete this.state[n],localStorage.setItem('luaScripts',JSON.stringify(this.state)),this.render(),App.log(`Script '${n}' deleted.`,"warn")},render(){const e=App.elements['saved-scripts-list'];e.innerHTML="",Object.keys(this.state).length===0?e.innerHTML='<div style="text-align:center;padding:.5rem;color:var(--c-text-dim)">No saved scripts.</div>':Object.keys(this.state).forEach(t=>{const n=document.createElement("div");n.className="script-item",n.innerHTML=`<span>${t}</span><button class="script-delete-btn" data-name="${t}">✖</button>`,n.onclick=o=>{o.target.tagName!=="BUTTON"&&(App.elements.input.value=this.state[t],App.handleInput(),App.log(`Script '${t}' loaded.`))},n.querySelector("button").onclick=()=>this.delete(t),e.appendChild(n)})}};
    
    const AI = {loadState(){App.elements['gemini-api-key'].value=localStorage.getItem('geminiApiKey')||'',App.elements['gemini-model'].value=localStorage.getItem('geminiModel')||'gemini-1.5-flash-latest'},async query(){const k=App.elements['gemini-api-key'].value,m=App.elements['gemini-model'].value;if(!k)return App.log("Gemini API key is missing.","error");App.setEngineBusy(true,'ai');let ctx="CONTEXT: You are a helpful Lua programming assistant. The user's active obfuscation settings are:\n";document.querySelectorAll("#settings-container input:checked").forEach(e=>ctx+=`- ${e.closest('.toggle-setting').querySelector('.toggle-label').textContent}\n`);const prompt=`${ctx}\nUSER TASK: ${App.elements['ai-prompt'].value}\n\nCURRENT LUA CODE IN EDITOR:\n\`\`\`lua\n${App.elements.input.value}\n\`\`\`\n\nRESPONSE:`;const url=`https://generativelanguage.googleapis.com/v1beta/models/${m}:generateContent?key=${k}`;try{const r=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})});if(!r.ok)throw new Error(`API error ${r.status}`);const d=await r.json();if(d.error)throw new Error(d.error.message);App.log("CEREBRUM RESPONSE:\n"+d.candidates[0].content.parts[0].text,'ai')}catch(e){App.log(`AI Error: ${e.message}`,"error")}finally{App.setEngineBusy(false)}}};

    document.addEventListener('DOMContentLoaded', () => App.init());
</script>
</body>
</html>
