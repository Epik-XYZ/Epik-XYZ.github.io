<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUA OBSCURA v5.1 - Aligner Engine</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/lua.min.js"></script>
    
    <style>
        /* CSS from v5.0 reused for base theme, but with critical fixes */
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Fira+Code&display=swap');
        :root{--font-main:'VT323',monospace;--font-code:'Fira Code',monospace;--glow-color:#ff00ff;--glow-color-alt:#00ffff;--glow-color-ai:#ffff00;--main-text:#e0e0e0;--bg-color:#05050a;--border-color:#4a004a;--terminal-text:#00ff41;--hl-keyword:var(--glow-color);--hl-string:#98c379;--hl-number:#d19a66;--hl-comment:#5c6370;--hl-function:var(--glow-color-alt)}.theme-matrix{--glow-color:#00ff41;--glow-color-alt:#008f11;--border-color:#005d00;--terminal-text:#00ff41;--glow-color-ai:#adff2f;--hl-keyword:var(--glow-color);--hl-string:#ccff00}.theme-fallout{--glow-color:#ffa500;--glow-color-alt:#d1b900;--border-color:#6d4f00;--terminal-text:#ffa500;--glow-color-ai:#ffeb3b;--hl-keyword:var(--glow-color);--hl-function:var(--glow-color);--hl-string:#90ee90}.theme-blueprint{--glow-color:#007bff;--glow-color-alt:#4da6ff;--border-color:#004a99;--bg-color:#f0f4f8;--main-text:#1a1a1a;--terminal-text:#0d6efd;--glow-color-ai:#fd7e14;--hl-keyword:#d73a49;--hl-string:#032f62;--hl-function:#6f42c1;--hl-comment:#6a737d}.theme-cyberdeck{--glow-color:#ff33A8;--glow-color-alt:#00f0ff;--border-color:#491a6d;--bg-color:#020a16;--terminal-text:#e5e5e5;--glow-color-ai:#ffae00;--hl-keyword:#ff79c6;--hl-string:#50fa7b;--hl-function:#8be9fd}.theme-vaporwave{--glow-color:#ff71ce;--glow-color-alt:#01cdfe;--border-color:#b441a1;--bg-color:#2c0c49;--terminal-text:#fff;--glow-color-ai:#f8e658;--hl-keyword:#f92672;--hl-string:#a6e22e;--hl-function:#66d9ef}.theme-monochrome{--glow-color:#fff;--glow-color-alt:#aaa;--border-color:#666;--bg-color:#000;--main-text:#fff;--terminal-text:#fff;--glow-color-ai:#fff;--hl-keyword:#fff;--hl-string:#fff;--hl-function:#fff;--hl-number:#fff}
        ::selection{background-color:rgba(0,123,255,0.4)}body{background-color:var(--bg-color);color:var(--main-text);font-family:var(--font-main);font-size:1.2rem;transition:background-color .5s,color .5s;overflow-x:hidden}.container{display:flex;flex-direction:column;min-height:100vh;padding:20px;box-sizing:border-box}header{text-align:center;margin-bottom:20px;animation:fadeInDown 0.5s ease-out}@keyframes fadeInDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}@keyframes border-glow{from{box-shadow:0 0 8px var(--border-color),0 0 8px var(--border-color) inset}to{box-shadow:0 0 16px var(--glow-color-alt),0 0 12px var(--border-color) inset}}@keyframes text-flicker{0%{opacity:1;text-shadow:0 0 10px var(--glow-color)}50%{opacity:.8;text-shadow:0 0 12px var(--glow-color)}100%{opacity:1;text-shadow:0 0 10px var(--glow-color)}}@keyframes pulse-glow{0%{box-shadow:0 0 8px var(--glow-color)}50%{box-shadow:0 0 18px var(--glow-color)}100%{box-shadow:0 0 8px var(--glow-color)}}h1{color:var(--glow-color);letter-spacing:5px;font-size:3em;margin:0;animation:text-flicker 5s linear infinite}.version{color:var(--glow-color-alt);font-size:1.2em}.description{font-family:var(--font-code);font-size:0.9em;max-width:800px;margin:10px auto}.theme-selector{display:flex;justify-content:center;gap:10px;margin-top:15px;flex-wrap:wrap}.theme-btn{background:0 0;border:1px solid var(--border-color);color:var(--main-text);padding:5px 10px;cursor:pointer;transition:all .2s;font-family:var(--font-main);font-size:1rem}.theme-btn:hover{transform:translateY(-2px)}.theme-btn.active{background-color:var(--glow-color);color:var(--bg-color);animation:pulse-glow 2s infinite}.main-grid{flex-grow:1;display:grid;grid-template-columns:300px 1fr;gap:20px;width:100%;max-width:1600px;margin:0 auto}@media(max-width:1000px){.main-grid{grid-template-columns:1fr}}.left-panel{display:flex;flex-direction:column;gap:15px;animation:fadeInDown 0.7s ease-out}.panel{border:1px solid var(--border-color);padding:15px;animation:border-glow 6s alternate infinite ease-in-out;background:rgba(0,0,0,0.2)}.ai-panel h2{color:var(--glow-color-ai);border-bottom-color:var(--glow-color-ai)}h2{font-size:1.5rem;text-shadow:0 0 5px var(--glow-color-alt);color:var(--glow-color-alt);margin:0 0 10px 0;border-bottom:1px dashed var(--border-color);padding-bottom:5px}.setting{display:flex;align-items:center;user-select:none}.setting input{display:none}.setting label{font-family:var(--font-code);font-size:.9rem;cursor:pointer;position:relative;padding-left:25px}.setting label::before{content:'';position:absolute;left:0;top:2px;width:15px;height:15px;border:1px solid var(--glow-color-alt);background-color:transparent;transition:all 0.2s}.setting input:checked+label::before{transform:rotate(45deg)}.setting input:checked+label::after{content:'X';font-family:var(--font-main);color:var(--glow-color);position:absolute;left:4px;top:-2px;font-size:1.2rem;animation:pop 0.2s}@keyframes pop{from{transform:scale(0.5);opacity:0}to{transform:scale(1);opacity:1}}.action-btn{transition:all .1s ease;transform:scale(1)}.action-btn:active{transform:scale(0.95)}.right-panel{display:flex;flex-direction:column;gap:20px;min-height:calc(100vh - 150px);animation:fadeInDown 0.9s ease-out}.io-box{position:relative;display:flex;flex-direction:column;flex:1;border:1px solid var(--border-color);background-color:rgba(0,0,0,0.5);min-height:300px}.io-box h2{padding:10px 15px 5px;margin:0;flex-shrink:0}.editor-container{position:relative;width:100%;flex-grow:1}.copy-btn{position:absolute;top:10px;right:15px;background:var(--glow-color);color:#000;border:none;font-family:var(--font-main);padding:5px 10px;cursor:pointer;opacity:.7;transition:opacity .2s;z-index:10}

        /* --- V5.1 CRITICAL TEXTBOX ALIGNMENT FIX --- */
        .code-editor-shared-styles { position:absolute; inset:0; box-sizing:border-box; width:100%; height:100%; margin:0; padding:15px; border:none; outline:none; white-space:pre-wrap; word-break:break-all; font-family:var(--font-code); font-size:0.9rem; line-height:1.5; letter-spacing:normal; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; tab-size:4; -moz-tab-size:4; overflow: auto; }
        .io-box h2 { padding:10px 15px; margin:0; border-bottom:1px solid var(--border-color); }
        .editor-container { padding-top:0; /* override h2 spacing */ }
        #input-lua { z-index:2; resize:none; background-color:transparent; color:transparent; caret-color:var(--main-text); }
        .input-highlighter, .output-code { z-index:1; }

        .ai-copilot-panel input,.ai-copilot-panel select,.ai-copilot-panel textarea{width:100%;box-sizing:border-box;background:rgba(0,0,0,0.5);border:1px solid var(--border-color);color:var(--main-text);font-family:var(--font-code);font-size:0.9rem;margin-bottom:10px;padding:5px}#query-ai-btn{border-color:var(--glow-color-ai);color:var(--glow-color-ai);font-size:1rem}.disclaimer{font-size:0.7rem;color:#888;margin-top:-5px}.console{width:100%;max-width:1600px;margin:15px auto 0;height:120px;background-color:#000;border:1px solid var(--border-color);padding:10px;overflow-y:auto;font-size:.9rem;font-family:var(--font-code);box-sizing:border-box}.console-line{opacity:0;transform:translateY(10px);transition:opacity 0.3s ease-out,transform 0.3s ease-out}.console-line.visible{opacity:1;transform:translateY(0)}.console-line.ai-response{background:rgba(255,255,255,0.05);padding:5px;border-left:2px solid var(--glow-color-ai);white-space:pre-wrap}.action-btn{background:0 0;padding:10px 15px;width:100%;margin-bottom:10px;font-family:var(--font-main);font-size:1.5rem;letter-spacing:3px;cursor:pointer;border:2px solid}#mutilate-btn:hover{background-color:var(--glow-color);color:var(--bg-color);box-shadow:0 0 15px var(--glow-color)}#deobfuscate-btn:hover{background-color:var(--glow-color-alt);color:var(--bg-color);box-shadow:0 0 15px var(--glow-color-alt)}#download-btn:hover{background-color:var(--main-text);color:var(--bg-color)}.hljs{color:var(--terminal-text);background:transparent}.hljs-keyword{color:var(--hl-keyword)}.hljs-string,.hljs-subst{color:var(--hl-string)}.hljs-number,.hljs-literal{color:var(--hl-number)}.hljs-comment{color:var(--hl-comment);font-style:italic}.hljs-title.function_{color:var(--hl-function)}.hljs-built_in{color:var(--glow-color-alt)}.ai-comment{color:var(--glow-color-ai)!important;font-style:normal!important;text-shadow:0 0 5px var(--glow-color-ai)}.console-line.error{color:#ff3333}.console-line.warn{color:#ffeb3b}.console-line.info{color:var(--glow-color-alt)}.console-line.ai{color:var(--glow-color-ai)}

        /* --- V5.1 GATEKEEPER SYSTEM & LOCK OVERLAY --- */
        #gatekeeper-modal{position:fixed;inset:0;z-index:1000;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);backdrop-filter:blur(5px)}.modal-content{width:90%;max-width:400px;padding:25px;border:1px solid var(--border-color);background:var(--bg-color);animation:fadeInScaleUp 0.3s}@keyframes fadeInScaleUp{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}.modal-content h3{color:var(--glow-color-alt);text-align:center}.modal-content input{width:100%;box-sizing:border-box;margin-bottom:15px}.modal-actions{display:flex;gap:10px}.modal-footer{margin-top:15px;text-align:center;font-size:0.9rem}.modal-footer .switch-link{color:var(--glow-color-alt);cursor:pointer;text-decoration:underline}#modal-message{margin-top:10px;color:var(--glow-color-ai);min-height:20px;text-align:center}#user-status-panel .username{color:var(--glow-color-ai)}
        
        .feature-container { position: relative; } /* A container for the feature and its lock */
        .lock-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.5); z-index: 5; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: var(--glow-color); cursor: pointer; visibility: hidden; opacity: 0; transition: all 0.2s; }
        .locked .lock-overlay { visibility: visible; opacity: 1; }
        .setting input:disabled+label { opacity:0.4; }
        .theme-btn.locked { opacity: 0.4; pointer-events: none; }
    </style>
</head>
<body>
    <div id="gatekeeper-modal"><!-- ... modal content ... --></div>
    <div class="container">
        <header><!-- ... header content ... --></header>
        <div class="main-grid">
            <div class="left-panel">
                 <div id="user-status-panel" class="panel"></div>
                 <div class="feature-container" id="ai-panel-wrapper">
                    <div class="panel ai-panel">
                        <h2>CEREBRUM AI Copilot</h2>
                        <input type="password" id="gemini-api-key" placeholder="Enter Gemini API Key">
                        <select id="gemini-model"><option value="gemini-1.5-flash-latest">Gemini 1.5 Flash (Fast)</option><option value="gemini-1.5-pro-latest">Gemini 1.5 Pro (Powerful)</option></select>
                        <textarea id="ai-prompt" placeholder="AI Prompt..."></textarea>
                        <button id="query-ai-btn" class="action-btn">QUERY AI</button>
                    </div>
                    <div class="lock-overlay">ðŸ”’</div>
                </div>
                <div class="panel">
                    <h2>Mutilation Settings</h2>
                    <div class="setting"><input type="checkbox" id="aiAugment"><label for="aiAugment">Engage AI Augmentation</label></div>
                    <div class="setting"><input type="checkbox" id="mangleNames" checked><label for="mangleNames">Mangle Variable Names</label></div>
                    <div class="setting"><input type="checkbox" id="renameGlobals" checked><label for="renameGlobals">Localize Global Functions</label></div>
                    <div class="setting"><input type="checkbox" id="abstractStrings" checked><label for="abstractStrings">Abstract Strings</label></div>
                    <div class="setting"><input type="checkbox" id="decomposeNumbers" checked><label for="decomposeNumbers">Decompose Numbers</label></div>
                    <div class="feature-container"><div class="setting"><input type="checkbox" id="mangleControlFlow"><label for="mangleControlFlow">Mangle Control-Flow</label></div><div class="lock-overlay">ðŸ”’</div></div>
                    <div class="feature-container"><div class="setting"><input type="checkbox" id="injectJunk"><label for="injectJunk">Inject Junk Code</label></div><div class="lock-overlay">ðŸ”’</div></div>
                    <div class="feature-container"><div class="setting"><input type="checkbox" id="serializeToHex"><label for="serializeToHex">Serialize to Hex</label></div><div class="lock-overlay">ðŸ”’</div></div>
                    <div class="setting"><input type="checkbox" id="useLoader"><label for="useLoader">Wrap in Eldritch Loader</label></div>
                    <div class="setting"><input type="checkbox" id="minify"><label for="minify">Minify Output</label></div>
                </div>
                <div class="panel"><!-- ...Engine Controls... --></div>
            </div>
            <div class="right-panel">
                 <div class="io-box"><h2>Input</h2><div class="editor-container"><textarea id="input-lua" class="code-editor-shared-styles" spellcheck="false"></textarea><pre class="input-highlighter"><code class="language-lua code-editor-shared-styles"></code></pre></div></div>
                 <div class="io-box"><h2>Output</h2><div class="editor-container"><pre class="output-code"><code class="language-lua code-editor-shared-styles"></code></pre><button id="copy-btn" class="copy-btn">COPY</button></div></div>
            </div>
        </div>
        <div class="console" id="console"></div>
    </div>
<!-- Populated static content for brevity -->
<script>document.querySelector('#gatekeeper-modal').innerHTML=`<div class="modal-content"><h3 id="modal-title">Account Required</h3><p class="disclaimer" style="text-align: center;">This is a SIMULATED login system. DO NOT use a real password.</p><div id="login-form"><input type="text" id="login-username" placeholder="Username" class="ai-copilot-panel"><input type="password" id="login-password" placeholder="Password" class="ai-copilot-panel"><div class="modal-actions"><button id="login-btn" class="action-btn" style="font-size:1.2rem; margin:0; border-color:var(--glow-color)">Login</button></div><div id="modal-message"></div><div class="modal-footer">Don't have an account? <span id="show-register-link" class="switch-link">Register</span></div></div><div id="register-form" style="display:none;"><input type="text" id="register-username" placeholder="Username" class="ai-copilot-panel"><input type="password" id="register-password" placeholder="Password" class="ai-copilot-panel"><input type="password" id="register-confirm-password" placeholder="Confirm Password" class="ai-copilot-panel"><div class="modal-actions"><button id="register-btn" class="action-btn" style="font-size:1.2rem; margin:0; border-color:var(--glow-color-alt)">Register</button></div><div id="modal-message-register"></div><div class="modal-footer">Already have an account? <span id="show-login-link" class="switch-link">Login</span></div></div></div>`;
document.querySelector('header').innerHTML=`<h1>LUA OBSCURA</h1><div class="version">v5.1 // Aligner Engine</div><p class="description">Authenticate with the GATEKEEPER to unlock the ARCHON's full potential. Basic obfuscation is a privilege; true alchemy requires an account.</p><div class="theme-selector"><button class="theme-btn" data-theme="theme-synthwave">Synthwave</button><button class="theme-btn" data-theme="theme-matrix">Matrix</button><button class="theme-btn" data-theme="theme-fallout">Fallout</button><button class="theme-btn" data-theme="theme-blueprint">Blueprint</button><button class="theme-btn" data-theme="theme-cyberdeck">Cyberdeck</button><button class="theme-btn" data-theme="theme-vaporwave">Vaporwave</button><button class="theme-btn" data-theme="theme-monochrome">Monochrome</button></div>`;
document.querySelector('.panel:nth-of-type(3)').innerHTML=`<h2>Engine Controls</h2><button id="mutilate-btn" class="action-btn">MUTILATE</button><button id="deobfuscate-btn" class="action-btn">REVEAL</button><button id="download-btn" class="action-btn">DOWNLOAD .LUA</button>`;
</script>

<script>
    // --- V5.1 Aligner Engine ---
    const getEl = id => document.getElementById(id);
    const $ = { body:document.body,input:getEl("input-lua"),inputHl:document.querySelector(".input-highlighter code"),outputHl:document.querySelector(".output-code code"),console:getEl("console"),mutilateBtn:getEl("mutilate-btn"),deobfuscateBtn:getEl("deobfuscate-btn"),downloadBtn:getEl("download-btn"),copyBtn:getEl("copy-btn"),settings:{serializeToHex:getEl("serializeToHex"),useLoader:getEl("useLoader")},gatekeeper:{modal:getEl("gatekeeper-modal"),loginForm:getEl("login-form"),registerForm:getEl("register-form"),loginBtn:getEl("login-btn"),registerBtn:getEl("register-btn"),showLoginLink:getEl("show-login-link"),showRegisterLink:getEl("show-register-link"),modalMsg:getEl("modal-message"),modalMsgReg:getEl("modal-message-register"),userStatusPanel:getEl("user-status-panel")},ai:{key:getEl("gemini-api-key"),model:getEl("gemini-model"),prompt:getEl("ai-prompt"),queryBtn:getEl("query-ai-btn")}};

    const consoleLog=(m,t="info")=>{const e=document.createElement("div");e.textContent=`> ${m}`,e.className=`console-line ${t}`,$.console.appendChild(e);setTimeout(()=>e.classList.add("visible"),10);$.console.scrollTop=$.console.scrollHeight};const sleep=e=>new Promise(t=>setTimeout(t,e));const gibberish=e=>`_${[...Array(e)].map(()=>"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(52*Math.random())]).join("")}`;const updateHighlight=()=>{const c=$.input.value;$.inputHl.innerHTML=c.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">"),hljs.highlightElement($.inputHl),localStorage.setItem("luaObscuraInput",c)};$.input.addEventListener("input",updateHighlight),$.input.addEventListener("scroll",()=>{$.inputHl.scrollTop=$.input.scrollTop,$.inputHl.scrollLeft=$.input.scrollLeft});
    
    // --- GATEKEEPER SYSTEM (V5.1 - Renders lock overlays) ---
    const GATEKEEPER = {
        init(){this.updateUIForUserStatus(),$.gatekeeper.showRegisterLink.onclick=()=>this.switchForm("register"),$.gatekeeper.showLoginLink.onclick=()=>this.switchForm("login"),$.gatekeeper.modal.onclick=e=>{"gatekeeper-modal"===e.target.id&&this.showModal(!1)},$.gatekeeper.registerBtn.onclick=()=>this.register(),$.gatekeeper.loginBtn.onclick=()=>this.login(),document.querySelectorAll(".lock-overlay").forEach(e=>{e.onclick=()=>this.promptLogin()})},
        getUsers(){return JSON.parse(localStorage.getItem("luaObscuraUsers")||"{}")},saveUsers(e){localStorage.setItem("luaObscuraUsers",JSON.stringify(e))},getCurrentUser(){return localStorage.getItem("loggedInUser")},showModal(e,t="login"){$.gatekeeper.modal.style.display=e?"flex":"none",this.switchForm(t),$.gatekeeper.modalMsg.textContent="",$.gatekeeper.modalMsgReg.textContent=""},switchForm(e){$.gatekeeper.loginForm.style.display="login"===e?"block":"none",$.gatekeeper.registerForm.style.display="register"===e?"block":"none",getEl("modal-title").textContent="login"===e?"Account Login":"Create Account"},
        promptLogin(){this.getCurrentUser()||(consoleLog("Access Denied: Authentication required for this feature.","warn"),this.showModal(!0,"login"))},
        register(){const e=getEl("register-username").value.trim(),t=getEl("register-password").value,o=getEl("register-confirm-password").value;if(!e||!t)return void($.gatekeeper.modalMsgReg.textContent="Username and password cannot be empty.");if(t!==o)return void($.gatekeeper.modalMsgReg.textContent="Passwords do not match.");const s=this.getUsers();if(s[e])return void($.gatekeeper.modalMsgReg.textContent="Username is already taken.");s[e]=t,this.saveUsers(s),$.gatekeeper.modalMsgReg.textContent="Registration successful! Logging in...",setTimeout(()=>this.login(e,t),1e3)},
        login(e,t){e=e||getEl("login-username").value.trim(),t=t||getEl("login-password").value;if(!e||!t)return void($.gatekeeper.modalMsg.textContent="Please enter username and password.");const o=this.getUsers();if(!o[e]||o[e]!==t)return void($.gatekeeper.modalMsg.textContent="Invalid username or password.");localStorage.setItem("loggedInUser",e),$.gatekeeper.modalMsg.textContent="Login Successful!",setTimeout(()=>{this.showModal(!1),this.updateUIForUserStatus()},500)},
        logout(){localStorage.removeItem("loggedInUser"),this.updateUIForUserStatus(),consoleLog("Successfully logged out.")},
        updateUIForUserStatus(){const e=this.getCurrentUser(),t=$.gatekeeper.userStatusPanel;e? (t.innerHTML=`<h2>User Status</h2><p>Welcome, <span class="username">${e}</span></p><button id="logout-btn" class="action-btn" style="font-size:1rem; border-color: #aaa">Logout</button>`,getEl("logout-btn").onclick=()=>this.logout()) : (t.innerHTML=`<h2>User Status</h2><p>Logged in as: <span class="username">Guest</span></p><button id="login-prompt-btn" class="action-btn" style="font-size:1rem;">Login / Register</button>`,getEl("login-prompt-btn").onclick=()=>this.showModal(!0,"login")),this.toggleFeatureAccess(!!e)},
        toggleFeatureAccess(isLoggedIn) {
            document.querySelectorAll(".feature-container").forEach(el => isLoggedIn ? el.classList.remove('locked') : el.classList.add('locked'));
            document.querySelectorAll(".feature-container input, .feature-container select, .feature-container textarea, .feature-container button").forEach(input => input.disabled = !isLoggedIn);
            document.querySelectorAll('.theme-btn').forEach(btn => {
                const isAdvancedTheme = ['theme-cyberdeck','theme-vaporwave','theme-monochrome'].includes(btn.dataset.theme);
                if (isAdvancedTheme) { isLoggedIn ? btn.classList.remove('locked') : btn.classList.add('locked'); }
                btn.onclick = () => { if(btn.classList.contains('locked')) { this.promptLogin(); } else { const theme = btn.dataset.theme; document.querySelectorAll('.theme-btn.active').forEach(b => b.classList.remove('active')); btn.classList.add('active'); $.body.className=theme; localStorage.setItem('luaObscuraTheme',theme); } };
            });
            const activeThemeBtn = document.querySelector('.theme-btn.active'); if(activeThemeBtn && activeThemeBtn.classList.contains('locked')) document.querySelector('.theme-btn[data-theme="theme-synthwave"]').click();
        }
    };
    // ... all other JS logic from v4.7 ...
    (async()=>{GATEKEEPER.init(); const savedInput=localStorage.getItem("luaObscuraInput"); $.input.value=savedInput || `function factorial(n)\n  if n == 0 then return 1 else return n * factorial(n - 1) end\nend\n\nprint("Factorial of 6 is: " .. tostring(factorial(6)))\nlocal status, msg = pcall(function() error("test error") end)\nif not status then print("Caught an error: "..msg) end`; updateHighlight();$.settings.serializeToHex.addEventListener('change', e=>{const t=e.target.checked;$.settings.useLoader.disabled=t,t&&($.settings.useLoader.checked=!1)})})();

</script>
</body>
</html>
